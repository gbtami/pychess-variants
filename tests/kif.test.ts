import { expect, test } from '@jest/globals';
import { parseKif } from '../client/kif';

const KIF = `#KIF version=2.0 encoding=UTF-8
開始日時：2020/11/12
場所：81Dojo
持ち時間：15分+60秒
手合割：六枚落ち
先手：elmasprr
後手：LittleMagician
手数----指手---------消費時間--
1   ３二金(41)   (0:5/0:0:5)
2   ３六歩(37)   (0:5/0:0:5)
3   ２二銀(31)   (0:4/0:0:9)
4   ４八銀(39)   (0:1/0:0:6)
5   ７二金(61)   (0:7/0:0:16)
6   ７八金(69)   (0:2/0:0:8)
7   ８二銀(71)   (0:2/0:0:18)
8   ４六歩(47)   (0:15/0:0:23)
9   ４二玉(51)   (0:15/0:0:33)
10   ５六歩(57)   (0:2/0:0:25)
11   ８四歩(83)   (0:11/0:0:44)
12   ７六歩(77)   (0:2/0:0:27)
13   ８三銀(82)   (0:4/0:0:48)
14   ６六歩(67)   (0:2/0:0:29)
15   ７四銀(83)   (0:2/0:0:50)
16   ７七金(78)   (0:1/0:0:30)
17   ６四歩(63)   (0:12/0:1:2)
18   ５七銀(48)   (0:2/0:0:32)
19   ８三金(72)   (0:1/0:1:3)
20   ９六歩(97)   (0:2/0:0:34)
21   ６五歩(64)   (0:28/0:1:31)
22   ９五歩(96)   (0:4/0:0:38)
23   ６六歩(65)   (0:1/0:1:32)
24   同　銀(57)   (0:1/0:0:39)
25   ６五歩打   (0:8/0:1:40)
26   ５七銀(66)   (0:1/0:0:40)
27   ４四歩(43)   (0:8/0:1:48)
28   ４八金(49)   (0:3/0:0:43)
29   ６三銀(74)   (0:13/0:2:1)
30   １六歩(17)   (0:6/0:0:49)
31   ２四歩(23)   (0:10/0:2:11)
32   １五歩(16)   (0:6/0:0:55)
33   ２三銀(22)   (0:10/0:2:21)
34   ３五歩(36)   (0:2/0:0:57)
35   ４三金(32)   (0:19/0:2:40)
36   ２六歩(27)   (0:14/0:1:11)
37   ３四歩(33)   (0:9/0:2:49)
38   ３八飛(28)   (0:4/0:1:15)
39   ３五歩(34)   (0:3/0:2:52)
40   同　飛(38)   (0:1/0:1:16)
41   ６四銀(63)   (0:12/0:3:4)
42   ６六歩打   (0:18/0:1:34)
43   同　歩(65)   (0:39/0:3:43)
44   ８六金(77)   (0:6/0:1:40)
45   ６七歩成(66)   (0:25/0:4:8)
46   ２五歩(26)   (0:24/0:2:4)
47   ５七と(67)   (0:24/0:4:32)
48   同　金(48)   (0:2/0:2:6)
49   ３四金(43)   (0:7/0:4:39)
50   ３八飛(35)   (0:9/0:2:15)
51   ２七銀打   (0:13/0:4:52)
52   ６八飛(38)   (0:15/0:2:30)
53   ６五歩打   (1:2/0:5:54)
54   ６三歩打   (0:43/0:3:13)
55   ４三玉(42)   (1:42/0:7:36)
56   ６二歩成(63)   (0:4/0:3:17)
57   ３八歩打   (0:41/0:8:17)
58   １四歩(15)   (0:18/0:3:35)
59   同　歩(13)   (0:8/0:8:25)
60   同　香(19)   (0:2/0:3:37)
61   同　銀(23)   (0:1/0:8:26)
62   １七桂(29)   (0:4/0:3:41)
63   ８五香打   (0:25/0:8:51)
64   ２四歩(25)   (0:6/0:3:47)
65   ８六香(85)   (0:4/0:8:55)
66   同　歩(87)   (0:1/0:3:48)
67   ８七金打   (0:7/0:9:2)
68   ２三歩成(24)   (0:13/0:4:1)
69   ８八金(87)   (0:2/0:9:4)
70   同　銀(79)   (0:4/0:4:5)
71   ２三銀(14)   (0:11/0:9:15)
72   ２九香打   (0:1/0:4:6)
73   ２八歩打   (0:5/0:9:20)
74   ３七金打   (0:8/0:4:14)
75   １八銀成(27)   (0:22/0:9:42)
76   ６三と(62)   (2:14/0:6:28)
77   ２九歩成(28)   (0:15/0:9:57)
78   ６四と(63)   (0:4/0:6:32)
79   ３九角打   (0:34/0:10:31)
80   ４八銀打   (0:34/0:7:6)
81   １七角成(39)   (0:16/0:10:47)
82   ６五飛(68)   (0:29/0:7:35)
83   ３九歩成(38)   (0:23/0:11:10)
84   ５三と(64)   (0:44/0:8:19)
85   同　玉(43)   (0:11/0:11:21)
86   ６一飛成(65)   (0:4/0:8:23)
87   ２八と(29)   (0:14/0:11:35)
88   ６四歩打   (0:17/0:8:40)
89   ６二歩打   (0:18/0:11:53)
90   ６三歩成(64)   (0:11/0:8:51)
91   同　歩(62)   (0:17/0:12:10)
92   ５一龍(61)   (0:6/0:8:57)
93   ５二歩打   (0:6/0:12:16)
94   ７七銀(88)   (0:6/0:9:3)
95   ３八と(28)   (0:4/0:12:20)
96   ６六銀(77)   (0:6/0:9:9)
97   ４八と(38)   (0:2/0:12:22)
98   ６九玉(59)   (0:1/0:9:10)
99   ３八と(39)   (0:8/0:12:30)
100   ５五銀(66)   (0:2/0:9:12)
101   ３七と(38)   (0:20/0:12:50)
102   １一龍(51)   (0:3/0:9:15)
103   ４七と(37)   (0:17/0:13:7)
104   １九歩打   (0:6/0:9:21)
105   ５七と(47)   (0:12/0:13:19)
106   ７八玉(69)   (0:13/0:9:34)
107   １二歩打   (1:42/0:15:1)
108   １八歩(19)   (0:5/0:9:39)
109   同　馬(17)   (0:2/0:15:3)
110   ５四銀打   (0:8/0:9:47)
111   同　馬(18)   (0:6/0:15:9)
112   同　銀(55)   (0:1/0:9:48)
113   同　玉(53)   (0:1/0:15:10)
114   ５五歩(56)   (0:11/0:9:59)
115   同　玉(54)   (0:5/0:15:15)
116   ７七角打   (0:5/0:10:4)
117   ６六桂打   (0:13/0:15:28)
118   ８七玉(78)   (0:8/0:10:12)
119   ７八銀打   (0:4/0:15:32)
120   ９六玉(87)   (0:3/0:10:15)
121   ８七銀打   (0:3/0:15:35)
122   ９七玉(96)   (0:3/0:10:18)
123   ９六香打   (0:7/0:15:42)
124   ５六歩打   (0:7/0:10:25)
*反則手にて終局`

test('parseKif test', () => { 
    const result = parseKif(KIF);
    expect(result['date']).toBe('2020/11/12');
    expect(result['place']).toBe('81Dojo');
    expect(result['tc']).toBe('15分+60秒');
    expect(result['handicap']).toBe('6-Piece HC');
    expect(result['sente']).toBe('elmasprr');
    expect(result['gote']).toBe('LittleMagician');
    expect(result['status']).toBe(11);  // not 10 (P@e4 is invalid move) because it is not indicated in move list, just in comment line
    expect(result['moves'].join(' ')).toBe('f9g8 g3g4 g9h8 g1f2 d9c8 d1c2 c9b8 f3f4 e9f8 e3e4 b7b6 c3c4 b8b7 d3d4 b7c6 c2c3 d7d6 f2e3 c8b7 a3a4 d6d5 a4a5 d5d4 e3d4 P@d5 d4e3 f7f6 f1f2 c6d7 i3i4 h7h6 i4i5 h8h7 g4g5 g8f7 h3h4 g7g6 h2g2 g6g5 g2g5 d7d6 P@d4 d5d4 c3b4 d4d3+ h4h5 d3e3 f2e3 f7g6 g5g2 S@h3 g2d2 P@d5 P@d7 f8f7 d7d8+ P@g2 i5i6 i7i6 i1i6 h7i6 h1i3 L@b5 h5h6 b5b4 b3b4 G@b3 h6h7+ b3b2 c1b2 i6h7 L@h1 P@h2 G@g3 h3i2+ d8d7 h2h1+ d7d6 B@g1 S@f2 g1i3+ d2d5 g2g1+ d6e7 f7e7 d5d9+ h1h2 P@d6 P@d8 d6d7+ d8d7 d9e9 P@e8 b2c3 h2g2 c3d4 g2f2 e1d1 g1g2 d4e5 g2g3 e9i9 g3f3 P@i1 f3e3 d1c2 P@i8 i1i2 i3i2 S@e6 i2e6 e5e6 e7e6 e4e5 e6e5 B@c3 N@d4 c2b3 S@c2 b3a4 S@b3 a4a3 L@a4 P@e4');
});
